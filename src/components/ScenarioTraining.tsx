import React, { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { Timer } from './Timer';
import { scenarioTrainingData } from '../data/trainingSteps';
import { TrainingStep, StepResult, TrainingResult } from '../types/training';
import { 
  Home, 
  ArrowLeft, 
  Clock, 
  CheckCircle, 
  XCircle, 
  AlertTriangle,
  User,
  Target,
  Play,
  Award,
  Brain,
  Search,
  FileText,
  MessageSquare,
  Lightbulb,
  Shield,
  Eye,
  Database,
  Zap,
  Users,
  ArrowRight
} from 'lucide-react';

const ScenarioTraining = () => {
  const { scenarioId } = useParams<{ scenarioId: string }>();
  const navigate = useNavigate();
  
  const [currentStep, setCurrentStep] = useState(1);
  const [completedSteps, setCompletedSteps] = useState<number[]>([]);
  const [stepResults, setStepResults] = useState<StepResult[]>([]);
  const [startTime, setStartTime] = useState<Date | null>(null);
  const [isTrainingComplete, setIsTrainingComplete] = useState(false);
  const [showFeedback, setShowFeedback] = useState(false);
  const [isCorrectAction, setIsCorrectAction] = useState(false);
  
  // Í∞Å Îã®Í≥ÑÎ≥Ñ ÏÑ†ÌÉù Í≤∞Í≥º Ï†ÄÏû•
  const [stepChoices, setStepChoices] = useState<{[key: number]: any}>({});
  const [currentTool, setCurrentTool] = useState<string>('');
  const [toolData, setToolData] = useState<any>({});
  const [showToolInterface, setShowToolInterface] = useState(false);
  const [toolLoading, setToolLoading] = useState(false);

  const scenario = scenarioId ? scenarioTrainingData[parseInt(scenarioId)] : null;
  const totalSteps = 8; // Í≥†Ï†ïÎêú 8Îã®Í≥Ñ

  useEffect(() => {
    if (scenario && !startTime) {
      setStartTime(new Date());
    }
  }, [scenario, startTime]);

  // SOC ÎèÑÍµ¨Î≥Ñ Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ Îç∞Ïù¥ÌÑ∞
  const getToolInterface = (stepId: number) => {
    switch (stepId) {
      case 1: // EDR Console
        return {
          toolName: 'EDR Console',
          toolIcon: 'üñ•Ô∏è',
          color: 'purple',
          interface: {
            alerts: [
              { id: 1, severity: 'HIGH', process: 'ransomware.exe', action: 'File Encryption', time: '14:23:17', status: 'ACTIVE' },
              { id: 2, severity: 'MEDIUM', process: 'explorer.exe', action: 'Unusual File Access', time: '14:23:15', status: 'INVESTIGATING' }
            ],
            processTree: {
              parent: 'winword.exe (PID: 1234)',
              children: ['ransomware.exe (PID: 5678)', 'crypto.dll (Loaded)']
            },
            networkConnections: [
              { ip: '203.0.113.45', port: '443', protocol: 'HTTPS', status: 'ESTABLISHED', direction: 'OUTBOUND' }
            ]
          }
        };
      
      case 2: // SIEM Query Interface
        return {
          toolName: 'SIEM Query Console',
          toolIcon: 'üìä',
          color: 'cyan',
          interface: {
            queryHistory: [
              'source="email" AND dest="FIN-PC-07" AND attachment="*.exe"',
              'index=web_logs src_ip="FIN-PC-07" | stats count by url',
              'index=usb_logs host="FIN-PC-07" action="connect"'
            ],
            timeline: [
              { time: '14:20:33', event: 'Email received: invoice.exe attachment', source: 'Mail Server', severity: 'INFO' },
              { time: '14:22:15', event: 'File execution detected', source: 'FIN-PC-07', severity: 'WARNING' },
              { time: '14:23:17', event: 'Mass file encryption started', source: 'EDR Agent', severity: 'CRITICAL' }
            ],
            searchResults: {
              emailLogs: { count: 15, suspicious: 1 },
              webLogs: { count: 0, suspicious: 0 },
              usbLogs: { count: 0, suspicious: 0 }
            }
          }
        };
      
      case 3: // Network Security Console
        return {
          toolName: 'Network Security Console',
          toolIcon: 'üåê',
          color: 'green',
          interface: {
            networkMap: {
              infected: [{ name: 'FIN-PC-07', ip: '192.168.1.107', status: 'INFECTED' }],
              clean: [
                { name: 'FIN-PC-01', ip: '192.168.1.101', status: 'CLEAN' },
                { name: 'FIN-PC-02', ip: '192.168.1.102', status: 'CLEAN' }
              ],
              isolated: []
            },
            isolationOptions: [
              { method: 'Network Cable Disconnect', time: 'Immediate', reversible: true },
              { method: 'Firewall Block', time: '30 seconds', reversible: true },
              { method: 'VLAN Quarantine', time: '2 minutes', reversible: true }
            ],
            evidenceTools: [
              { name: 'Memory Dump', status: 'Ready', size: '8GB', time: '3 min' },
              { name: 'Screen Capture', status: 'Ready', size: '2MB', time: '5 sec' },
              { name: 'Process List', status: 'Ready', size: '1MB', time: '10 sec' }
            ]
          }
        };
      
      case 4: // Digital Forensics Toolkit
        return {
          toolName: 'Digital Forensics Toolkit',
          toolIcon: 'üîç',
          color: 'orange',
          interface: {
            availableTools: [
              { name: 'Volatility', version: '3.0', purpose: 'Memory Analysis' },
              { name: 'FTK Imager', version: '4.5', purpose: 'Disk Imaging' },
              { name: 'KAPE', version: '1.3', purpose: 'Artifact Collection' }
            ],
            acquisitionStatus: {
              memoryDump: { status: 'Ready', estimatedTime: '3 minutes', integrity: 'MD5 + SHA256' },
              diskImage: { status: 'Ready', estimatedTime: '45 minutes', integrity: 'Bit-by-bit copy' },
              liveArtifacts: { status: 'Ready', estimatedTime: '5 minutes', integrity: 'Hash verified' }
            },
            chainOfCustody: {
              investigator: 'SOC Analyst',
              timestamp: '2024-01-15 14:25:00',
              location: 'Finance Department',
              witness: 'IT Manager'
            }
          }
        };
      
      case 5: // Threat Intelligence Platform
        return {
          toolName: 'Threat Intelligence Platform',
          toolIcon: 'üß†',
          color: 'indigo',
          interface: {
            searchQuery: {
              type: 'File Hash',
              value: 'a1b2c3d4e5f6789012345678901234567890abcd',
              status: 'Analyzing...'
            },
            threatIntel: {
              malwareFamily: 'WannaCry Variant',
              threatActor: 'Lazarus Group (APT38)',
              firstSeen: '2024-01-10 08:30:00',
              lastSeen: '2024-01-15 12:45:00',
              confidence: 'High (87%)',
              severity: 'Critical'
            },
            relatedIOCs: [
              { type: 'IP', value: '203.0.113.45', reputation: 'Malicious', sources: 5 },
              { type: 'Domain', value: 'malware-c2.evil.com', reputation: 'Malicious', sources: 8 },
              { type: 'File Hash', value: 'b2c3d4e5f6...', reputation: 'Suspicious', sources: 3 }
            ],
            campaigns: [
              { name: 'Operation Ghost', active: true, targets: 'Financial Sector' }
            ]
          }
        };
      
      case 6: // SIEM Dashboard (Impact Assessment)
        return {
          toolName: 'SIEM Impact Dashboard',
          toolIcon: 'üìà',
          color: 'red',
          interface: {
            impactMetrics: {
              affectedSystems: { count: 1, percentage: '0.5%' },
              encryptedFiles: { count: 1247, size: '15.6 GB' },
              affectedUsers: { count: 3, department: 'Finance' },
              downtime: { duration: '23 minutes', cost: '$12,500' }
            },
            spreadAnalysis: {
              networkSpread: 'CONTAINED',
              lateralMovement: 'NOT DETECTED',
              dataExfiltration: 'UNDER INVESTIGATION',
              persistenceMechanisms: 'NONE FOUND'
            },
            businessImpact: {
              primaryImpact: 'Finance Department Offline',
              secondaryImpact: 'Month-end Reporting Delayed',
              complianceRisk: 'Medium',
              reputationRisk: 'Low'
            }
          }
        };
      
      case 7: // SOAR Playbook Console
        return {
          toolName: 'SOAR Playbook Console',
          toolIcon: '‚ö°',
          color: 'yellow',
          interface: {
            recommendedPlaybooks: [
              { 
                name: 'Ransomware Incident Response', 
                steps: 12, 
                eta: '15 minutes',
                automation: '75%',
                success_rate: '94%'
              },
              { 
                name: 'Malware Containment', 
                steps: 8, 
                eta: '10 minutes',
                automation: '85%',
                success_rate: '98%'
              }
            ],
            currentExecution: {
              playbook: 'None Selected',
              progress: '0%',
              nextAction: 'Select Playbook',
              approvalRequired: true
            },
            automationCapabilities: [
              { action: 'Network Isolation', automated: true, approval: false },
              { action: 'Evidence Collection', automated: true, approval: false },
              { action: 'Threat Hunting', automated: false, approval: true },
              { action: 'System Recovery', automated: false, approval: true }
            ]
          }
        };
      
      case 8: // Incident Management System
        return {
          toolName: 'Incident Management System',
          toolIcon: 'üìã',
          color: 'blue',
          interface: {
            ticketInfo: {
              ticketID: 'INC-2024-0115-001',
              priority: 'P1 - Critical',
              status: 'In Progress',
              assignee: 'SOC Team Lead',
              created: '2024-01-15 14:23:30',
              sla: '4 hours remaining'
            },
            stakeholders: [
              { role: 'CEO', notified: true, acknowledged: false },
              { role: 'CISO', notified: true, acknowledged: true },
              { role: 'IT Director', notified: true, acknowledged: true },
              { role: 'Legal Counsel', notified: false, acknowledged: false }
            ],
            reportGeneration: {
              executiveSummary: 'Ready',
              technicalDetails: 'In Progress',
              lessonsLearned: 'Pending',
              actionItems: 'Draft'
            },
            communicationLog: [
              { time: '14:25', action: 'Initial notification sent', recipient: 'CISO' },
              { time: '14:30', action: 'Situation update', recipient: 'Executive Team' }
            ]
          }
        };
      
      default:
        return null;
    }
  };

  // 8Îã®Í≥Ñ Íµ¨ÏÑ± Îç∞Ïù¥ÌÑ∞
  const getStepData = (stepId: number) => {
    const baseData = {
      who: stepChoices[5]?.attacker || "ÏïåÎ†§ÏßÄÏßÄ ÏïäÏùÄ Í≥µÍ≤©Ïûê",
      where: stepChoices[6]?.target || "FIN-PC-07",
      what: stepChoices[1]?.threatType || "ÎûúÏÑ¨Ïõ®Ïñ¥",
      when: "2024-01-15 14:23:17",
      how: stepChoices[2]?.method || "Ïù¥Î©îÏùº Ï≤®Î∂ÄÌååÏùº",
      howMuch: stepChoices[7]?.impact || "ÌöåÍ≥Ñ Î¨∏ÏÑú ÏïîÌò∏Ìôî"
    };

    switch (stepId) {
      case 1: // ÏúÑÌòë ÏãùÎ≥Ñ
        return {
          title: "1Îã®Í≥Ñ: ÏúÑÌòë ÏãùÎ≥Ñ",
          description: "EDR Í≤ΩÎ≥¥Î•º Î∂ÑÏÑùÌïòÏó¨ ÏúÑÌòë Ïú†ÌòïÏùÑ ÏãùÎ≥ÑÌïòÏÑ∏Ïöî",
          icon: <AlertTriangle className="w-6 h-6 text-red-400" />,
          data: {
            alertInfo: "FIN-PC-07ÏóêÏÑú P1 Îì±Í∏â Í≤ΩÎ≥¥ Î∞úÏÉù",
            processName: "ransomware.exe",
            behavior: "ÎåÄÎüâ ÌååÏùº ÏïîÌò∏Ìôî ÏãúÎèÑ",
            networkActivity: "Ïô∏Î∂Ä IPÏôÄ ÌÜµÏã† Ï§ë"
          },
          question: "üö® Ïù¥ Í≤ΩÎ≥¥Í∞Ä ÎÇòÌÉÄÎÇ¥Îäî ÏúÑÌòë Ïú†ÌòïÏùÄ Î¨¥ÏóáÏûÖÎãàÍπå?",
          options: [
            { id: "ransomware", label: "üîí ÎûúÏÑ¨Ïõ®Ïñ¥ Í≥µÍ≤©", description: "ÌååÏùºÏùÑ ÏïîÌò∏ÌôîÌïòÏó¨ Í∏àÏ†Ñ ÏöîÍµ¨" },
            { id: "spyware", label: "üëÅÔ∏è Ïä§ÌååÏù¥Ïõ®Ïñ¥", description: "Ï†ïÎ≥¥ ÏàòÏßë Î∞è Í∞êÏãú" },
            { id: "ddos", label: "‚ö° DDoS Í≥µÍ≤©", description: "ÏÑúÎπÑÏä§ ÎßàÎπÑ Í≥µÍ≤©" },
            { id: "false_positive", label: "‚ùå Ïò§ÌÉê", description: "Ï†ïÏÉÅÏ†ÅÏù∏ ÌôúÎèôÏúºÎ°ú ÌåêÎã®" }
          ],
          correctAnswer: "ransomware"
        };

      case 2: // Í∞êÏóº Í≤ΩÎ°ú Ï∂îÏ†ï
        return {
          title: "2Îã®Í≥Ñ: Í∞êÏóº Í≤ΩÎ°ú Ï∂îÏ†ï",
          description: `${stepChoices[1]?.threatType || 'ÏúÑÌòë'}Ïù¥ Ïñ¥ÎñªÍ≤å ÏãúÏä§ÌÖúÏóê Ïπ®ÏûÖÌñàÎäîÏßÄ Ï∂îÏ†ïÌïòÏÑ∏Ïöî`,
          icon: <Search className="w-6 h-6 text-blue-400" />,
          data: {
            timelineInfo: "14:20 Ïù¥Î©îÏùº ÏàòÏã† ‚Üí 14:22 Ï≤®Î∂ÄÌååÏùº Ïã§Ìñâ ‚Üí 14:23 Í≤ΩÎ≥¥ Î∞úÏÉù",
            emailLogs: "invoice.exe Ï≤®Î∂ÄÌååÏùºÏù¥ Ìè¨Ìï®Îêú Ïù¥Î©îÏùº",
            browserHistory: "ÏùòÏã¨Ïä§Îü¨Ïö¥ ÏõπÏÇ¨Ïù¥Ìä∏ Î∞©Î¨∏ Í∏∞Î°ù ÏóÜÏùå",
            usbActivity: "USB Ïó∞Í≤∞ Í∏∞Î°ù ÏóÜÏùå"
          },
          question: "üîç Í∞ÄÏû• Í∞ÄÎä•ÏÑ±Ïù¥ ÎÜíÏùÄ Í∞êÏóº Í≤ΩÎ°úÎäî Î¨¥ÏóáÏûÖÎãàÍπå?",
          options: [
            { id: "email", label: "üìß Ïù¥Î©îÏùº Ï≤®Î∂ÄÌååÏùº", description: "ÏïÖÏÑ± Ï≤®Î∂ÄÌååÏùº Ïã§Ìñâ" },
            { id: "web", label: "üåê ÏïÖÏÑ± ÏõπÏÇ¨Ïù¥Ìä∏", description: "ÎìúÎùºÏù¥Î∏å Î∞îÏù¥ Îã§Ïö¥Î°úÎìú" },
            { id: "usb", label: "üíæ USB Í∞êÏóº", description: "Í∞êÏóºÎêú USB Ïó∞Í≤∞" },
            { id: "network", label: "üåê ÎÑ§Ìä∏ÏõåÌÅ¨ Ïπ®Ìà¨", description: "ÎÑ§Ìä∏ÏõåÌÅ¨ Ï∑®ÏïΩÏ†ê ÏïÖÏö©" }
          ],
          correctAnswer: "email"
        };

      case 3: // Ï¶âÏãú Ï°∞Ïπò Í≤∞Ï†ï
        return {
          title: "3Îã®Í≥Ñ: Ï¶âÏãú Ï°∞Ïπò Í≤∞Ï†ï",
          description: `${stepChoices[1]?.threatType || 'ÏúÑÌòë'} ÌôïÏÇ∞ÏùÑ ÎßâÍ∏∞ ÏúÑÌïú Ï¶âÏãú Ï°∞ÏπòÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî`,
          icon: <Shield className="w-6 h-6 text-green-400" />,
          data: {
            currentStatus: "Í∞êÏóº ÏßÑÌñâ Ï§ë, ÌååÏùº ÏïîÌò∏Ìôî Í≥ÑÏÜçÎê®",
            networkStatus: "Îã§Î•∏ ÏãúÏä§ÌÖúÏúºÎ°ú ÌôïÏÇ∞ Í∞ÄÎä•ÏÑ± ÏûàÏùå",
            evidenceStatus: "ÌòÑÏû¨ Î©îÎ™®Î¶¨Ïóê Ï§ëÏöî Ï¶ùÍ±∞ Ï°¥Ïû¨",
            timeConstraint: "Í≥®Îì†ÌÉÄÏûÑ 7Î∂Ñ ÎÇ®Ïùå"
          },
          question: "‚ö° Í∞ÄÏû• Ïö∞ÏÑ†Ï†ÅÏúºÎ°ú Ìï¥Ïïº Ìï† Ï°∞ÏπòÎäî Î¨¥ÏóáÏûÖÎãàÍπå?",
          options: [
            { id: "isolate", label: "üîå ÎÑ§Ìä∏ÏõåÌÅ¨ Í≤©Î¶¨", description: "ÌôïÏÇ∞ Î∞©ÏßÄÎ•º ÏúÑÌïú ÎÑ§Ìä∏ÏõåÌÅ¨ Ï∞®Îã®" },
            { id: "preserve", label: "üì∏ Ï¶ùÍ±∞ Î≥¥Ï°¥", description: "ÌôîÎ©¥ Ï∫°Ï≤ò Î∞è Î©îÎ™®Î¶¨ Îç§ÌîÑ" },
            { id: "shutdown", label: "‚ö° ÏãúÏä§ÌÖú Ï¢ÖÎ£å", description: "Ï¶âÏãú Ï†ÑÏõê Ï∞®Îã®" },
            { id: "antivirus", label: "üõ°Ô∏è Î∞±Ïã† Ïã§Ìñâ", description: "ÏïÖÏÑ±ÏΩîÎìú Ï†úÍ±∞ ÏãúÎèÑ" }
          ],
          correctAnswer: "preserve"
        };

      case 4: // Ï¶ùÍ±∞ ÏàòÏßë Î∞©Î≤ï
        return {
          title: "4Îã®Í≥Ñ: Ï¶ùÍ±∞ ÏàòÏßë Î∞©Î≤ï",
          description: `${stepChoices[3]?.action || 'Ï°∞Ïπò'} ÌõÑ Ïñ¥Îñ§ Ï¶ùÍ±∞Î•º ÏàòÏßëÌï¥Ïïº Ìï†ÍπåÏöî?`,
          icon: <FileText className="w-6 h-6 text-purple-400" />,
          data: {
            availableEvidence: "Î©îÎ™®Î¶¨ Îç§ÌîÑ, ÌïòÎìúÎîîÏä§ÌÅ¨ Ïù¥ÎØ∏ÏßÄ, ÎÑ§Ìä∏ÏõåÌÅ¨ Î°úÍ∑∏, ÌôîÎ©¥ Ï∫°Ï≤ò",
            timeLimit: "Ï¶ùÍ±∞ ÏàòÏßë ÏãúÍ∞Ñ Ï†úÌïú: 5Î∂Ñ",
            priority: "Î≤ïÏ†ï Ï¶ùÍ±∞ Îä•Î†•ÏùÑ Í∞ñÏ∂ò Ï¶ùÍ±∞ ÌïÑÏöî",
            resources: "Ìè¨Î†åÏãù ÎèÑÍµ¨ ÏÇ¨Ïö© Í∞ÄÎä•"
          },
          question: "üìã Í∞ÄÏû• Ï§ëÏöîÌïú Ï¶ùÍ±∞Îäî Î¨¥ÏóáÏûÖÎãàÍπå?",
          options: [
            { id: "memory", label: "üß† Î©îÎ™®Î¶¨ Îç§ÌîÑ", description: "Ïã§Ìñâ Ï§ëÏù∏ ÏïÖÏÑ± ÌîÑÎ°úÏÑ∏Ïä§ Ï†ïÎ≥¥" },
            { id: "disk", label: "üíΩ ÌïòÎìúÎîîÏä§ÌÅ¨ Ïù¥ÎØ∏ÏßÄ", description: "Ï†ÑÏ≤¥ ÏãúÏä§ÌÖú ÏÉÅÌÉú Î≥¥Ï°¥" },
            { id: "network", label: "üåê ÎÑ§Ìä∏ÏõåÌÅ¨ Î°úÍ∑∏", description: "Ïô∏Î∂Ä ÌÜµÏã† Í∏∞Î°ù" },
            { id: "screen", label: "üì∏ ÌôîÎ©¥ Ï∫°Ï≤ò", description: "ÎûúÏÑ¨ÎÖ∏Ìä∏ Î∞è ÌòÑÏû¨ ÏÉÅÌÉú" }
          ],
          correctAnswer: "memory"
        };

      case 5: // Í≥µÍ≤©Ïûê Ï∂îÏ†Å
        return {
          title: "5Îã®Í≥Ñ: Í≥µÍ≤©Ïûê Ï∂îÏ†Å",
          description: `ÏàòÏßëÎêú ${stepChoices[4]?.evidence || 'Ï¶ùÍ±∞'}Î•º Î∞îÌÉïÏúºÎ°ú Í≥µÍ≤©ÏûêÎ•º Ï∂îÏ†ÅÌïòÏÑ∏Ïöî`,
          icon: <Eye className="w-6 h-6 text-yellow-400" />,
          data: {
            ipAddress: "203.0.113.45 (Ïô∏Î∂Ä IP)",
            fileHash: "a1b2c3d4e5f6789012345678901234567890abcd",
            c2Server: "malware-command.evil.com",
            geolocation: "ÎèôÏú†ÎüΩ ÏßÄÏó≠ÏúºÎ°ú Ï∂îÏ†ï"
          },
          question: "üïµÔ∏è Ïù¥ Í≥µÍ≤©Ïùò Î∞∞ÌõÑÎäî ÎàÑÍµ¨Ïùº Í∞ÄÎä•ÏÑ±Ïù¥ ÎÜíÏäµÎãàÍπå?",
          options: [
            { id: "apt", label: "üéØ APT Í∑∏Î£π", description: "Íµ≠Í∞Ä ÏßÄÏõê Ìï¥ÌÇπ Í∑∏Î£π" },
            { id: "criminal", label: "üí∞ ÏÇ¨Ïù¥Î≤Ñ Î≤îÏ£ÑÏûê", description: "Í∏àÏ†ÑÏ†Å Ïù¥Ïùµ Ï∂îÍµ¨" },
            { id: "insider", label: "üë§ ÎÇ¥Î∂ÄÏûê", description: "ÎÇ¥Î∂Ä ÏßÅÏõêÏùò ÏïÖÏùòÏ†Å ÌñâÏúÑ" },
            { id: "script_kiddie", label: "üî∞ Ïä§ÌÅ¨Î¶ΩÌä∏ ÌÇ§Îîî", description: "Í∏∞Ïà†Î†•Ïù¥ ÎÇÆÏùÄ Ìï¥Ïª§" }
          ],
          correctAnswer: "criminal"
        };

      case 6: // ÌîºÌï¥ Î≤îÏúÑ ÌèâÍ∞Ä
        return {
          title: "6Îã®Í≥Ñ: ÌîºÌï¥ Î≤îÏúÑ ÌèâÍ∞Ä",
          description: `${stepChoices[5]?.attacker || 'Í≥µÍ≤©Ïûê'}Ïùò Í≥µÍ≤©ÏúºÎ°ú Ïù∏Ìïú ÌîºÌï¥ Î≤îÏúÑÎ•º ÌèâÍ∞ÄÌïòÏÑ∏Ïöî`,
          icon: <Target className="w-6 h-6 text-orange-400" />,
          data: {
            affectedSystems: "FIN-PC-07 (ÌôïÏù∏Îê®)",
            networkScan: "Îã§Î•∏ ÏãúÏä§ÌÖú Í∞êÏóº Ïó¨Î∂Ä Ï°∞ÏÇ¨ Ï§ë",
            dataStatus: "ÌöåÍ≥Ñ Î¨∏ÏÑú 1,247Í∞ú ÏïîÌò∏ÌôîÎê®",
            businessImpact: "Ïû¨Î¨¥ÌåÄ ÏóÖÎ¨¥ Ï§ëÎã®"
          },
          question: "üìä Ï£ºÏöî ÌîºÌï¥ ÎåÄÏÉÅÏùÄ Î¨¥ÏóáÏûÖÎãàÍπå?",
          options: [
            { id: "single_pc", label: "üíª Îã®Ïùº PC", description: "FIN-PC-07Îßå Í∞êÏóº" },
            { id: "department", label: "üè¢ Î∂ÄÏÑú Ï†ÑÏ≤¥", description: "Ïû¨Î¨¥ÌåÄ Ï†ÑÏ≤¥ ÏãúÏä§ÌÖú" },
            { id: "network", label: "üåê Ï†ÑÏÇ¨ ÎÑ§Ìä∏ÏõåÌÅ¨", description: "ÌöåÏÇ¨ Ï†ÑÏ≤¥ ÏãúÏä§ÌÖú" },
            { id: "external", label: "üîó Ïô∏Î∂Ä Ïó∞Í≤∞", description: "Í≥†Í∞ùÏÇ¨ÍπåÏßÄ ÌôïÏÇ∞" }
          ],
          correctAnswer: "single_pc"
        };

      case 7: // ÎåÄÏùë Ï†ÑÎûµ ÏàòÎ¶Ω
        return {
          title: "7Îã®Í≥Ñ: ÎåÄÏùë Ï†ÑÎûµ ÏàòÎ¶Ω",
          description: `${stepChoices[6]?.target || 'ÌîºÌï¥ Î≤îÏúÑ'}Ïóê ÎßûÎäî ÎåÄÏùë Ï†ÑÎûµÏùÑ ÏàòÎ¶ΩÌïòÏÑ∏Ïöî`,
          icon: <Brain className="w-6 h-6 text-cyan-400" />,
          data: {
            availableOptions: "Í≤©Î¶¨, Î≥µÍµ¨, ÌòëÏÉÅ, Î≤ïÏ†Å ÎåÄÏùë",
            backupStatus: "ÏµúÏã† Î∞±ÏóÖ: Ïñ¥Ï†ú 23:00",
            decryptionTool: "Î¨¥Î£å Î≥µÌò∏Ìôî ÎèÑÍµ¨ ÏóÜÏùå",
            ransomAmount: "ÎπÑÌä∏ÏΩîÏù∏ 0.5Í∞ú ÏöîÍµ¨"
          },
          question: "üéØ ÏµúÏ†ÅÏùò ÎåÄÏùë Ï†ÑÎûµÏùÄ Î¨¥ÏóáÏûÖÎãàÍπå?",
          options: [
            { id: "restore", label: "üîÑ Î∞±ÏóÖ Î≥µÍµ¨", description: "Î∞±ÏóÖÏúºÎ°úÎ∂ÄÌÑ∞ ÏãúÏä§ÌÖú Î≥µÍµ¨" },
            { id: "negotiate", label: "üí¨ ÌòëÏÉÅ", description: "Í≥µÍ≤©ÏûêÏôÄ ÌòëÏÉÅ ÏãúÎèÑ" },
            { id: "pay", label: "üí∞ Î™∏Í∞í ÏßÄÎ∂à", description: "ÏöîÍµ¨ Í∏àÏï° ÏßÄÎ∂à" },
            { id: "rebuild", label: "üî® ÏãúÏä§ÌÖú Ïû¨Íµ¨Ï∂ï", description: "Ï≤òÏùåÎ∂ÄÌÑ∞ ÏãúÏä§ÌÖú Ïû¨ÏÑ§Ïπò" }
          ],
          correctAnswer: "restore"
        };

      case 8: // ÏÇ¨ÌõÑ Ï°∞Ïπò
        return {
          title: "8Îã®Í≥Ñ: ÏÇ¨ÌõÑ Ï°∞Ïπò",
          description: `${stepChoices[7]?.strategy || 'ÎåÄÏùë Ï†ÑÎûµ'} Ïã§Ìñâ ÌõÑ ÌïÑÏöîÌïú ÏÇ¨ÌõÑ Ï°∞ÏπòÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî`,
          icon: <Users className="w-6 h-6 text-indigo-400" />,
          data: {
            recoveryStatus: "ÏãúÏä§ÌÖú Î≥µÍµ¨ ÏôÑÎ£å",
            securityGap: "Ïù¥Î©îÏùº Î≥¥Ïïà Í∞ïÌôî ÌïÑÏöî",
            reporting: "Í≤ΩÏòÅÏßÑ Î≥¥Í≥† ÎåÄÍ∏∞",
            prevention: "Ïû¨Î∞ú Î∞©ÏßÄ ÎåÄÏ±Ö ÏàòÎ¶Ω ÌïÑÏöî"
          },
          question: "üìã Í∞ÄÏû• Ï§ëÏöîÌïú ÏÇ¨ÌõÑ Ï°∞ÏπòÎäî Î¨¥ÏóáÏûÖÎãàÍπå?",
          options: [
            { id: "report", label: "üìä Í≤ΩÏòÅÏßÑ Î≥¥Í≥†", description: "ÏÇ¨Í≥† Í≤ΩÏúÑ Î∞è ÎåÄÏùë Í≤∞Í≥º Î≥¥Í≥†" },
            { id: "security", label: "üîí Î≥¥Ïïà Í∞ïÌôî", description: "Ïù¥Î©îÏùº Î≥¥Ïïà Ï†ïÏ±Ö Í∞úÏÑ†" },
            { id: "training", label: "üìö ÏßÅÏõê ÍµêÏú°", description: "ÌîºÏã± Î©îÏùº ÎåÄÏùë ÍµêÏú°" },
            { id: "monitoring", label: "üëÅÔ∏è Î™®ÎãàÌÑ∞ÎßÅ Í∞ïÌôî", description: "24ÏãúÍ∞Ñ Í∞êÏãú Ï≤¥Í≥Ñ Íµ¨Ï∂ï" }
          ],
          correctAnswer: "report"
        };

      default:
        return null;
    }
  };

  const handleChoice = (choice: any) => {
    const stepData = getStepData(currentStep);
    if (!stepData) return;

    const isCorrect = choice.id === stepData.correctAnswer;
    setIsCorrectAction(isCorrect);
    setShowFeedback(true);

    // ÏÑ†ÌÉù Í≤∞Í≥º Ï†ÄÏû•
    const newStepChoices = {
      ...stepChoices,
      [currentStep]: {
        ...choice,
        isCorrect,
        timestamp: new Date().toISOString()
      }
    };
    setStepChoices(newStepChoices);

    // Í≤∞Í≥º Ï†ÄÏû•
    const result: StepResult = {
      stepId: currentStep,
      status: isCorrect ? 'success' : 'failure',
      data: choice,
      timestamp: new Date().toISOString(),
      score: isCorrect ? 100 : 0
    };

    setStepResults(prev => [...prev, result]);

    if (isCorrect) {
      setCompletedSteps(prev => [...prev, currentStep]);
    }

    // SOC ÎèÑÍµ¨ Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ ÌëúÏãú
    const toolInterface = getToolInterface(currentStep);
    if (toolInterface) {
      setToolLoading(true);
      setCurrentTool(toolInterface.toolName);
      
      // Ïã§Ï†ú ÎèÑÍµ¨ Î°úÎî© ÏãúÎÆ¨Î†àÏù¥ÏÖò
      setTimeout(() => {
        setToolData(toolInterface);
        setToolLoading(false);
        setShowToolInterface(true);
      }, 1500);
    }
  };

  const handleNextStep = () => {
    if (currentStep < totalSteps) {
      setCurrentStep(currentStep + 1);
      setShowFeedback(false);
      setIsCorrectAction(false);
      setShowToolInterface(false);
      setToolData({});
      setCurrentTool('');
    } else {
      // ÌõàÎ†® ÏôÑÎ£å
      setIsTrainingComplete(true);
    }
  };

  const handlePrevStep = () => {
    if (currentStep > 1) {
      setCurrentStep(currentStep - 1);
      setShowFeedback(false);
      setIsCorrectAction(false);
      setShowToolInterface(false);
      setToolData({});
      setCurrentTool('');
    }
  };

  if (!scenario) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-800 text-white flex items-center justify-center">
        <div className="text-center">
          <AlertTriangle className="w-16 h-16 text-red-400 mx-auto mb-4" />
          <h1 className="text-2xl font-bold text-red-400 mb-4">ÏãúÎÇòÎ¶¨Ïò§Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§</h1>
          <button
            onClick={() => navigate('/courses')}
            className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            ÏΩîÏä§ ÏÑ†ÌÉùÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
          </button>
        </div>
      </div>
    );
  }

  if (isTrainingComplete) {
    const completionRate = (completedSteps.length / totalSteps) * 100;
    const badge = completionRate >= 80 ? 'leader' : completionRate >= 60 ? 'competent' : 'trainee';
    
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-800 text-white">
        <div className="container mx-auto px-4 py-8">
          {/* ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */}
          <div className="mb-6">
            <div className="flex gap-4">
              <button
                onClick={() => navigate('/')}
                className="flex items-center gap-2 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all duration-300"
              >
                <Home className="w-4 h-4" />
                ÌôàÏúºÎ°ú Í∞ÄÍ∏∞
              </button>
              <button
                onClick={() => navigate('/courses')}
                className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-300"
              >
                <ArrowLeft className="w-4 h-4" />
                ÏΩîÏä§ ÏÑ†ÌÉùÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
              </button>
            </div>
          </div>

          {/* ÏôÑÎ£å ÌôîÎ©¥ */}
          <div className="text-center">
            <div className="text-6xl mb-8">
              {badge === 'leader' ? 'üèÜ' : badge === 'competent' ? 'ü•à' : 'ü•â'}
            </div>
            <h1 className="text-4xl font-bold text-yellow-400 mb-6">ÌõàÎ†® ÏôÑÎ£å!</h1>
            
            <div className="bg-black/50 backdrop-blur-sm border border-green-500/30 rounded-lg p-8 mb-8 max-w-4xl mx-auto">
              <div className="text-4xl mb-4">
                {completedSteps.length} / {totalSteps}
              </div>
              <div className="text-xl text-green-300 mb-6">
                ÏôÑÎ£åÏú®: {Math.round(completionRate)}%
              </div>
              
              {/* 6Ìïò ÏõêÏπô Í≤∞Í≥º */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                <div className="bg-gray-800/50 p-4 rounded-lg">
                  <p className="text-yellow-300 font-bold">ÎàÑÍ∞Ä (Who)</p>
                  <p className="text-green-200 text-sm">{stepChoices[5]?.label || 'ÎØ∏ÌôïÏù∏'}</p>
                </div>
                <div className="bg-gray-800/50 p-4 rounded-lg">
                  <p className="text-yellow-300 font-bold">Î¨¥ÏóáÏùÑ (What)</p>
                  <p className="text-green-200 text-sm">{stepChoices[1]?.label || 'ÎØ∏ÌôïÏù∏'}</p>
                </div>
                <div className="bg-gray-800/50 p-4 rounded-lg">
                  <p className="text-yellow-300 font-bold">Ïñ∏Ï†ú (When)</p>
                  <p className="text-green-200 text-sm">2024-01-15 14:23:17</p>
                </div>
                <div className="bg-gray-800/50 p-4 rounded-lg">
                  <p className="text-yellow-300 font-bold">Ïñ¥ÎîîÏÑú (Where)</p>
                  <p className="text-green-200 text-sm">{stepChoices[6]?.label || 'ÎØ∏ÌôïÏù∏'}</p>
                </div>
                <div className="bg-gray-800/50 p-4 rounded-lg">
                  <p className="text-yellow-300 font-bold">Ïñ¥ÎñªÍ≤å (How)</p>
                  <p className="text-green-200 text-sm">{stepChoices[2]?.label || 'ÎØ∏ÌôïÏù∏'}</p>
                </div>
                <div className="bg-gray-800/50 p-4 rounded-lg">
                  <p className="text-yellow-300 font-bold">ÏñºÎßàÎÇò (How much)</p>
                  <p className="text-green-200 text-sm">{stepChoices[7]?.label || 'ÎØ∏ÌôïÏù∏'}</p>
                </div>
              </div>
              
              <div className="text-lg text-yellow-300">
                ÌöçÎìù Î∞∞ÏßÄ: {badge === 'leader' ? 'üèÜ ÎåÄÏùë Î¶¨Îçî' : badge === 'competent' ? 'ü•à Ïú†Îä•Ìïú Î∂ÑÏÑùÍ∞Ä' : 'ü•â ÌõàÎ†®ÏÉù'}
              </div>
            </div>

            <button
              onClick={() => navigate('/courses')}
              className="px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 border-2 border-blue-400 rounded-lg text-white font-bold text-xl hover:from-blue-500 hover:to-blue-600 transition-all duration-300"
            >
              Îã§Î•∏ ÏãúÎÇòÎ¶¨Ïò§ ÎèÑÏ†ÑÌïòÍ∏∞
            </button>
          </div>
        </div>
      </div>
    );
  }

  const currentStepData = getStepData(currentStep);

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-800 text-white">
      {/* ÌÉÄÏù¥Î®∏ */}
      <Timer initialMinutes={10} />
      
      <div className="container mx-auto px-4 py-8">
        {/* ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */}
        <div className="mb-6">
          <div className="flex gap-4">
            <button
              onClick={() => navigate('/')}
              className="flex items-center gap-2 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all duration-300"
            >
              <Home className="w-4 h-4" />
              ÌôàÏúºÎ°ú Í∞ÄÍ∏∞
            </button>
            <button
              onClick={() => navigate('/courses')}
              className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-300"
            >
              <ArrowLeft className="w-4 h-4" />
              ÏΩîÏä§ ÏÑ†ÌÉùÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
            </button>
          </div>
        </div>

        {/* ÏßÑÌñâÏÉÅÌô© */}
        <div className="mb-8">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-xl font-bold text-blue-400">ÏßÑÌñâ ÏÉÅÌô©</h2>
            <span className="text-green-400 font-bold">
              {currentStep} / {totalSteps}
            </span>
          </div>
          <div className="flex gap-2 mb-4">
            {Array.from({ length: totalSteps }, (_, i) => (
              <div
                key={i + 1}
                className={`flex-1 h-3 rounded-full transition-all duration-300 ${
                  completedSteps.includes(i + 1)
                    ? 'bg-green-500'
                    : i + 1 === currentStep
                    ? 'bg-yellow-500'
                    : 'bg-gray-600'
                }`}
              />
            ))}
          </div>
          <div className="flex justify-between text-xs text-gray-400">
            {Array.from({ length: totalSteps }, (_, i) => (
              <span key={i + 1}>{i + 1}</span>
            ))}
          </div>
        </div>

        {/* ÌòÑÏû¨ Îã®Í≥Ñ */}
        {currentStepData && (
          <div className="bg-black/50 backdrop-blur-sm border border-yellow-500/30 rounded-lg p-8 mb-8">
            {/* Îã®Í≥Ñ Ìó§Îçî */}
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-4">
                <div className="bg-yellow-500 text-black rounded-full w-12 h-12 flex items-center justify-center font-bold text-lg">
                  {currentStep}
                </div>
                <div>
                  <h2 className="text-2xl font-bold text-yellow-400 flex items-center gap-3">
                    {currentStepData.icon}
                    {currentStepData.title}
                  </h2>
                  <p className="text-green-200 text-lg mt-2">{currentStepData.description}</p>
                </div>
              </div>
            </div>

            {/* ÏàòÏßëÎêú Ï†ïÎ≥¥ */}
            <div className="mb-6">
              <h3 className="text-lg font-bold text-cyan-400 mb-3">üìä ÏàòÏßëÎêú Ï†ïÎ≥¥</h3>
              <div className="bg-gray-800/50 p-4 rounded-lg">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                  {Object.entries(currentStepData.data).map(([key, value]) => (
                    <div key={key} className="flex justify-between">
                      <span className="text-yellow-300 capitalize">{key.replace(/([A-Z])/g, ' $1')}:</span>
                      <span className="text-green-200">{value}</span>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            {/* ÏßàÎ¨∏ Î∞è ÏÑ†ÌÉùÏßÄ */}
            {!showFeedback && (
              <div className="space-y-6">
                <div>
                  <h3 className="text-xl font-bold text-green-300 mb-4">{currentStepData.question}</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {currentStepData.options.map((option) => (
                      <button
                        key={option.id}
                        onClick={() => handleChoice(option)}
                        className="p-4 rounded-lg border-2 border-gray-600 bg-gray-800/30 hover:border-yellow-400 hover:bg-yellow-900/20 transition-all duration-300 text-left group"
                      >
                        <div className="flex items-start gap-3">
                          <div className="text-2xl">{option.label.split(' ')[0]}</div>
                          <div>
                            <div className="font-bold text-green-300 group-hover:text-yellow-300 transition-colors">
                              {option.label.substring(2)}
                            </div>
                            <div className="text-sm text-gray-400 mt-1">
                              {option.description}
                            </div>
                          </div>
                        </div>
                      </button>
                    ))}
                  </div>
                </div>
              </div>
            )}

            {/* ÌîºÎìúÎ∞± */}
            {showFeedback && (
              <div className="space-y-6">
                {/* SOC ÎèÑÍµ¨ Î°úÎî© */}
                {toolLoading && (
                  <div className="bg-gray-800/50 border border-blue-500/30 rounded-lg p-6">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-400"></div>
                      <h3 className="text-lg font-bold text-blue-400">SOC ÎèÑÍµ¨ Ïó∞Í≤∞ Ï§ë...</h3>
                    </div>
                    <div className="bg-black/50 p-4 rounded-lg font-mono text-sm">
                      <div className="text-green-400 mb-2">
                        {'>'} {currentTool} Ï¥àÍ∏∞Ìôî Ï§ë...
                      </div>
                      <div className="space-y-1 text-gray-400">
                        <div>{'>'} Î≥¥Ïïà Ïó∞Í≤∞ ÏÑ§Ï†ï...</div>
                        <div>{'>'} Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî...</div>
                        <div>{'>'} Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ Î°úÎî©...</div>
                      </div>
                    </div>
                  </div>
                )}

                {/* SOC ÎèÑÍµ¨ Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ */}
                {showToolInterface && toolData && (
                  <div className={`bg-gray-800/50 border border-${toolData.color}-500/30 rounded-lg p-6`}>
                    <div className="flex items-center gap-3 mb-4">
                      <span className="text-2xl">{toolData.toolIcon}</span>
                      <h3 className={`text-xl font-bold text-${toolData.color}-400`}>
                        {toolData.toolName}
                      </h3>
                      <div className={`px-2 py-1 bg-${toolData.color}-900/30 text-${toolData.color}-300 text-xs rounded-full`}>
                        CONNECTED
                      </div>
                    </div>

                    {/* ÎèÑÍµ¨Î≥Ñ Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ Î†åÎçîÎßÅ */}
                    <div className="bg-black/50 p-4 rounded-lg">
                      {currentStep === 1 && toolData.interface && (
                        <div className="space-y-4">
                          <div>
                            <h4 className="text-purple-300 font-bold mb-2">üö® Active Alerts</h4>
                            <div className="space-y-2">
                              {toolData.interface.alerts?.map((alert: any, idx: number) => (
                                <div key={idx} className={`p-2 rounded border-l-4 ${
                                  alert.severity === 'HIGH' ? 'border-red-500 bg-red-900/20' : 'border-yellow-500 bg-yellow-900/20'
                                }`}>
                                  <div className="flex justify-between items-center">
                                    <span className="font-mono text-sm">{alert.process}</span>
                                    <span className={`px-2 py-1 rounded text-xs ${
                                      alert.severity === 'HIGH' ? 'bg-red-600 text-white' : 'bg-yellow-600 text-white'
                                    }`}>
                                      {alert.severity}
                                    </span>
                                  </div>
                                  <div className="text-gray-300 text-xs mt-1">{alert.action} at {alert.time}</div>
                                </div>
                              ))}
                            </div>
                          </div>
                          <div>
                            <h4 className="text-purple-300 font-bold mb-2">üå≥ Process Tree</h4>
                            <div className="font-mono text-sm text-green-300">
                              <div>‚îî‚îÄ {toolData.interface.processTree?.parent}</div>
                              {toolData.interface.processTree?.children?.map((child: string, idx: number) => (
                                <div key={idx} className="ml-4">‚îú‚îÄ {child}</div>
                              ))}
                            </div>
                          </div>
                        </div>
                      )}

                      {currentStep === 2 && toolData.interface && (
                        <div className="space-y-4">
                          <div>
                            <h4 className="text-cyan-300 font-bold mb-2">üìä Query Results</h4>
                            <div className="grid grid-cols-3 gap-4">
                              <div className="text-center p-2 bg-gray-700/50 rounded">
                                <div className="text-2xl font-bold text-green-400">{toolData.interface.searchResults?.emailLogs?.suspicious}</div>
                                <div className="text-xs text-gray-400">Suspicious Emails</div>
                              </div>
                              <div className="text-center p-2 bg-gray-700/50 rounded">
                                <div className="text-2xl font-bold text-gray-400">{toolData.interface.searchResults?.webLogs?.suspicious}</div>
                                <div className="text-xs text-gray-400">Web Threats</div>
                              </div>
                              <div className="text-center p-2 bg-gray-700/50 rounded">
                                <div className="text-2xl font-bold text-gray-400">{toolData.interface.searchResults?.usbLogs?.suspicious}</div>
                                <div className="text-xs text-gray-400">USB Infections</div>
                              </div>
                            </div>
                          </div>
                          <div>
                            <h4 className="text-cyan-300 font-bold mb-2">‚è∞ Timeline Analysis</h4>
                            <div className="space-y-2">
                              {toolData.interface.timeline?.map((event: any, idx: number) => (
                                <div key={idx} className="flex items-center gap-3 p-2 bg-gray-700/30 rounded">
                                  <span className="font-mono text-xs text-yellow-400">{event.time}</span>
                                  <span className="text-sm text-green-300">{event.event}</span>
                                  <span className={`px-2 py-1 rounded text-xs ${
                                    event.severity === 'CRITICAL' ? 'bg-red-600' : 
                                    event.severity === 'WARNING' ? 'bg-yellow-600' : 'bg-blue-600'
                                  } text-white`}>
                                    {event.severity}
                                  </span>
                                </div>
                              ))}
                            </div>
                          </div>
                        </div>
                      )}

                      {currentStep === 3 && toolData.interface && (
                        <div className="space-y-4">
                          <div>
                            <h4 className="text-green-300 font-bold mb-2">üó∫Ô∏è Network Map</h4>
                            <div className="grid grid-cols-2 gap-4">
                              <div>
                                <div className="text-red-400 font-bold mb-2">üî¥ Infected Systems</div>
                                {toolData.interface.networkMap?.infected?.map((system: any, idx: number) => (
                                  <div key={idx} className="p-2 bg-red-900/20 border border-red-500/30 rounded">
                                    <div className="font-mono text-sm">{system.name}</div>
                                    <div className="text-xs text-gray-400">{system.ip}</div>
                                  </div>
                                ))}
                              </div>
                              <div>
                                <div className="text-green-400 font-bold mb-2">üü¢ Clean Systems</div>
                                {toolData.interface.networkMap?.clean?.slice(0, 2).map((system: any, idx: number) => (
                                  <div key={idx} className="p-2 bg-green-900/20 border border-green-500/30 rounded mb-1">
                                    <div className="font-mono text-sm">{system.name}</div>
                                    <div className="text-xs text-gray-400">{system.ip}</div>
                                  </div>
                                ))}
                              </div>
                            </div>
                          </div>
                        </div>
                      )}

                      {currentStep === 4 && toolData.interface && (
                        <div className="space-y-4">
                          <div>
                            <h4 className="text-orange-300 font-bold mb-2">üîß Available Tools</h4>
                            <div className="grid grid-cols-3 gap-2">
                              {toolData.interface.availableTools?.map((tool: any, idx: number) => (
                                <div key={idx} className="p-2 bg-gray-700/50 rounded text-center">
                                  <div className="font-bold text-sm">{tool.name}</div>
                                  <div className="text-xs text-gray-400">{tool.purpose}</div>
                                </div>
                              ))}
                            </div>
                          </div>
                          <div>
                            <h4 className="text-orange-300 font-bold mb-2">üì¶ Evidence Collection Status</h4>
                            <div className="space-y-2">
                              <div className="flex justify-between items-center p-2 bg-green-900/20 rounded">
                                <span>Memory Dump</span>
                                <span className="text-green-400 font-bold">READY</span>
                              </div>
                              <div className="flex justify-between items-center p-2 bg-blue-900/20 rounded">
                                <span>Chain of Custody</span>
                                <span className="text-blue-400 font-bold">VERIFIED</span>
                              </div>
                            </div>
                          </div>
                        </div>
                      )}

                      {currentStep === 5 && toolData.interface && (
                        <div className="space-y-4">
                          <div>
                            <h4 className="text-indigo-300 font-bold mb-2">üîç Threat Analysis</h4>
                            <div className="p-3 bg-red-900/20 border border-red-500/30 rounded">
                              <div className="grid grid-cols-2 gap-4">
                                <div>
                                  <div className="text-red-400 font-bold">{toolData.interface.threatIntel?.malwareFamily}</div>
                                  <div className="text-sm text-gray-300">Threat Actor: {toolData.interface.threatIntel?.threatActor}</div>
                                </div>
                                <div>
                                  <div className="text-yellow-400 font-bold">Confidence: {toolData.interface.threatIntel?.confidence}</div>
                                  <div className="text-sm text-gray-300">Severity: {toolData.interface.threatIntel?.severity}</div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div>
                            <h4 className="text-indigo-300 font-bold mb-2">üéØ Related IOCs</h4>
                            <div className="space-y-1">
                              {toolData.interface.relatedIOCs?.slice(0, 2).map((ioc: any, idx: number) => (
                                <div key={idx} className="flex justify-between items-center p-2 bg-gray-700/30 rounded">
                                  <span className="font-mono text-sm">{ioc.value}</span>
                                  <span className={`px-2 py-1 rounded text-xs ${
                                    ioc.reputation === 'Malicious' ? 'bg-red-600' : 'bg-yellow-600'
                                  } text-white`}>
                                    {ioc.reputation}
                                  </span>
                                </div>
                              ))}
                            </div>
                          </div>
                        </div>
                      )}

                      {currentStep === 6 && toolData.interface && (
                        <div className="space-y-4">
                          <div>
                            <h4 className="text-red-300 font-bold mb-2">üìä Impact Metrics</h4>
                            <div className="grid grid-cols-2 gap-4">
                              <div className="p-3 bg-red-900/20 rounded">
                                <div className="text-2xl font-bold text-red-400">{toolData.interface.impactMetrics?.affectedSystems?.count}</div>
                                <div className="text-sm text-gray-300">Affected Systems</div>
                              </div>
                              <div className="p-3 bg-yellow-900/20 rounded">
                                <div className="text-2xl font-bold text-yellow-400">{toolData.interface.impactMetrics?.encryptedFiles?.count}</div>
                                <div className="text-sm text-gray-300">Encrypted Files</div>
                              </div>
                            </div>
                          </div>
                          <div>
                            <h4 className="text-red-300 font-bold mb-2">üè¢ Business Impact</h4>
                            <div className="p-3 bg-gray-700/30 rounded">
                              <div className="text-orange-400 font-bold">{toolData.interface.businessImpact?.primaryImpact}</div>
                              <div className="text-sm text-gray-300 mt-1">{toolData.interface.businessImpact?.secondaryImpact}</div>
                            </div>
                          </div>
                        </div>
                      )}

                      {currentStep === 7 && toolData.interface && (
                        <div className="space-y-4">
                          <div>
                            <h4 className="text-yellow-300 font-bold mb-2">üìã Recommended Playbooks</h4>
                            <div className="space-y-2">
                              {toolData.interface.recommendedPlaybooks?.map((playbook: any, idx: number) => (
                                <div key={idx} className="p-3 bg-yellow-900/20 border border-yellow-500/30 rounded">
                                  <div className="flex justify-between items-center">
                                    <div>
                                      <div className="font-bold text-yellow-300">{playbook.name}</div>
                                      <div className="text-sm text-gray-300">{playbook.steps} steps ‚Ä¢ {playbook.eta}</div>
                                    </div>
                                    <div className="text-right">
                                      <div className="text-green-400 font-bold">{playbook.success_rate}</div>
                                      <div className="text-xs text-gray-400">Success Rate</div>
                                    </div>
                                  </div>
                                </div>
                              ))}
                            </div>
                          </div>
                        </div>
                      )}

                      {currentStep === 8 && toolData.interface && (
                        <div className="space-y-4">
                          <div>
                            <h4 className="text-blue-300 font-bold mb-2">üé´ Incident Ticket</h4>
                            <div className="p-3 bg-blue-900/20 border border-blue-500/30 rounded">
                              <div className="grid grid-cols-2 gap-4">
                                <div>
                                  <div className="text-blue-400 font-bold">{toolData.interface.ticketInfo?.ticketID}</div>
                                  <div className="text-sm text-gray-300">{toolData.interface.ticketInfo?.priority}</div>
                                </div>
                                <div>
                                  <div className="text-green-400 font-bold">{toolData.interface.ticketInfo?.status}</div>
                                  <div className="text-sm text-gray-300">SLA: {toolData.interface.ticketInfo?.sla}</div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div>
                            <h4 className="text-blue-300 font-bold mb-2">üë• Stakeholder Notifications</h4>
                            <div className="space-y-1">
                              {toolData.interface.stakeholders?.slice(0, 3).map((stakeholder: any, idx: number) => (
                                <div key={idx} className="flex justify-between items-center p-2 bg-gray-700/30 rounded">
                                  <span>{stakeholder.role}</span>
                                  <span className={`px-2 py-1 rounded text-xs ${
                                    stakeholder.acknowledged ? 'bg-green-600' : 'bg-yellow-600'
                                  } text-white`}>
                                    {stakeholder.acknowledged ? 'ACKNOWLEDGED' : 'PENDING'}
                                  </span>
                                </div>
                              ))}
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                <div className={`p-6 rounded-lg border-2 ${
                  isCorrectAction 
                    ? 'border-green-500 bg-green-900/20' 
                    : 'border-orange-500 bg-orange-900/20'
                }`}>
                  <div className="flex items-center gap-3 mb-4">
                    {isCorrectAction ? (
                      <CheckCircle className="w-8 h-8 text-green-400" />
                    ) : (
                      <XCircle className="w-8 h-8 text-orange-400" />
                    )}
                    <h3 className="text-xl font-bold text-yellow-400">
                      {isCorrectAction ? '‚úÖ Ï†ïÎãµÏûÖÎãàÎã§!' : '‚ö†Ô∏è Îã§Ïãú ÏÉùÍ∞ÅÌï¥Î≥¥ÏÑ∏Ïöî'}
                    </h3>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <h4 className="text-lg font-bold text-cyan-400 mb-3">üìä ÎãπÏã†Ïùò ÏÑ†ÌÉù</h4>
                      <div className="bg-gray-800/50 p-4 rounded-lg">
                        <p className="font-bold text-green-300">{stepChoices[currentStep]?.label}</p>
                        <p className="text-sm text-gray-300 mt-2">{stepChoices[currentStep]?.description}</p>
                      </div>
                    </div>
                    
                    <div>
                      <h4 className="text-lg font-bold text-green-400 mb-3">‚úÖ Ï†ÑÎ¨∏Í∞Ä Ìï¥ÏÑ§</h4>
                      <div className="bg-gray-800/50 p-4 rounded-lg">
                        <p className={`font-bold ${isCorrectAction ? 'text-green-300' : 'text-orange-300'}`}>
                          {isCorrectAction 
                            ? 'Ïò¨Î∞îÎ•∏ ÌåêÎã®ÏûÖÎãàÎã§. Ïù¥ ÏÑ†ÌÉùÏù¥ ÏµúÏ†ÅÏùò ÎåÄÏùëÏûÖÎãàÎã§.'
                            : 'Ïù¥ ÏÉÅÌô©ÏóêÏÑúÎäî Îã§Î•∏ Ï†ëÍ∑ºÏù¥ Îçî Ìö®Í≥ºÏ†ÅÏùº Ïàò ÏûàÏäµÎãàÎã§.'
                          }
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î≤ÑÌäº */}
                <div className="flex justify-between">
                  <button
                    onClick={handlePrevStep}
                    disabled={currentStep === 1}
                    className="flex items-center gap-2 px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300"
                  >
                    <ArrowLeft className="w-5 h-5" />
                    Ïù¥Ï†Ñ Îã®Í≥Ñ
                  </button>

                  <button
                    onClick={handleNextStep}
                    className="flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all duration-300"
                  >
                    {currentStep === totalSteps ? 'ÌõàÎ†® ÏôÑÎ£å' : 'Îã§Ïùå Îã®Í≥Ñ'}
                    {currentStep < totalSteps ? (
                      <ArrowRight className="w-5 h-5" />
                    ) : (
                      <Award className="w-5 h-5" />
                    )}
                  </button>
                </div>
              </div>
            )}
          </div>
        )}
      </div>
    </div>
  );
};

export default ScenarioTraining;